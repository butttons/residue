---
import { Cloud, Download, FolderGit2, KeyRound, LogIn } from "lucide-astro";
---

<div id="quick-start" class="mb-20">
    <h2 class="text-3xl font-bold mb-3 text-center">Quick Start</h2>
    <p class="text-zinc-500 text-sm text-center mb-10 max-w-lg mx-auto">
        One-time setup to deploy your own backend, then per-project
        configuration.
    </p>

    <div class="max-w-4xl mx-auto space-y-10">
        <!-- One-time setup label -->
        <div class="flex items-center gap-3">
            <div class="h-px flex-1 bg-zinc-800"></div>
            <span class="text-xs text-zinc-500 uppercase tracking-wider"
                >One-time setup</span
            >
            <div class="h-px flex-1 bg-zinc-800"></div>
        </div>

        <!-- Step 1: Get R2 credentials -->
        <div class="bg-zinc-900 border border-zinc-800 rounded-lg p-6">
            <div class="flex items-start gap-4">
                <div
                    class="w-8 h-8 rounded-full bg-amber-500/10 border border-amber-500/30 flex items-center justify-center shrink-0 mt-0.5"
                >
                    <KeyRound class="w-4 h-4 text-amber-400" />
                </div>
                <div class="flex-1 min-w-0">
                    <div class="flex items-center gap-2 mb-1">
                        <span class="text-xs text-amber-400 font-semibold"
                            >Step 1</span
                        >
                    </div>
                    <h3 class="text-base font-semibold mb-3">
                        Create an R2 bucket and S3 API token
                    </h3>

                    <div class="space-y-3 font-mono text-sm">
                        <div>
                            <p class="text-zinc-400 text-xs mb-2">
                                Create an R2 bucket in the Cloudflare dashboard:
                            </p>
                            <div class="bg-zinc-950 rounded p-3">
                                <a
                                    href="https://dash.cloudflare.com/?to=/:account/r2/new"
                                    target="_blank"
                                    rel="noopener noreferrer"
                                    class="text-amber-400 hover:underline break-all"
                                    >dash.cloudflare.com/?to=/:account/r2/new</a
                                >
                            </div>
                        </div>

                        <div>
                            <p class="text-zinc-400 text-xs mb-2">
                                Then create an S3 API token with read/write
                                access to your bucket:
                            </p>
                            <div class="bg-zinc-950 rounded p-3">
                                <a
                                    href="https://dash.cloudflare.com/?to=/:account/r2/api-tokens"
                                    target="_blank"
                                    rel="noopener noreferrer"
                                    class="text-amber-400 hover:underline break-all"
                                    >dash.cloudflare.com/?to=/:account/r2/api-tokens</a
                                >
                            </div>
                        </div>
                    </div>

                    <div
                        class="mt-4 bg-zinc-950 border border-zinc-800 rounded p-4"
                    >
                        <p class="text-zinc-400 text-xs mb-2">
                            Save these values -- you will need them in step 2:
                        </p>
                        <div class="font-mono text-sm space-y-1.5">
                            <div class="flex items-center gap-2">
                                <span class="text-zinc-500 w-44 shrink-0"
                                    >R2_ACCESS_KEY_ID</span
                                >
                                <span class="text-zinc-600"
                                    >from the API token</span
                                >
                            </div>
                            <div class="flex items-center gap-2">
                                <span class="text-zinc-500 w-44 shrink-0"
                                    >R2_SECRET_ACCESS_KEY</span
                                >
                                <span class="text-zinc-600"
                                    >from the API token</span
                                >
                            </div>
                            <div class="flex items-center gap-2">
                                <span class="text-zinc-500 w-44 shrink-0"
                                    >R2_ACCOUNT_ID</span
                                >
                                <span class="text-zinc-600"
                                    >your Cloudflare account ID</span
                                >
                            </div>
                            <div class="flex items-center gap-2">
                                <span class="text-zinc-500 w-44 shrink-0"
                                    >R2_BUCKET_NAME</span
                                >
                                <span class="text-zinc-600"
                                    >the bucket you just created</span
                                >
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 2: Deploy the worker -->
        <div class="bg-zinc-900 border border-zinc-800 rounded-lg p-6">
            <div class="flex items-start gap-4">
                <div
                    class="w-8 h-8 rounded-full bg-amber-500/10 border border-amber-500/30 flex items-center justify-center shrink-0 mt-0.5"
                >
                    <Cloud class="w-4 h-4 text-amber-400" />
                </div>
                <div class="flex-1 min-w-0">
                    <div class="flex items-center gap-2 mb-1">
                        <span class="text-xs text-amber-400 font-semibold"
                            >Step 2</span
                        >
                    </div>
                    <h3 class="text-base font-semibold mb-3">
                        Deploy the worker
                    </h3>

                    <p class="text-zinc-400 text-sm mb-4">
                        Click the button below to deploy residue to your
                        Cloudflare account. It will provision the D1 database
                        and R2 bucket binding automatically.
                    </p>

                    <div class="mb-4">
                        <a
                            href="https://deploy.workers.cloudflare.com/?url=https://github.com/butttons/residue/tree/main/packages/worker"
                            target="_blank"
                            rel="noopener noreferrer"
                        >
                            <img
                                src="https://deploy.workers.cloudflare.com/button"
                                alt="Deploy to Cloudflare"
                                class="h-10"
                            />
                        </a>
                    </div>

                    <div class="bg-zinc-950 border border-zinc-800 rounded p-4">
                        <p class="text-zinc-400 text-xs mb-2">
                            During deploy, you will be prompted for these
                            secrets:
                        </p>
                        <div class="font-mono text-sm space-y-1.5">
                            <div class="flex items-center gap-2">
                                <span class="text-zinc-500 w-44 shrink-0"
                                    >AUTH_TOKEN</span
                                >
                                <span class="text-zinc-600"
                                    >generate a random string -- this is your
                                    CLI auth token</span
                                >
                            </div>
                            <div class="flex items-center gap-2">
                                <span class="text-zinc-500 w-44 shrink-0"
                                    >R2_SECRET_ACCESS_KEY</span
                                >
                                <span class="text-zinc-600">from step 1</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <span class="text-zinc-500 w-44 shrink-0"
                                    >ADMIN_PASSWORD</span
                                >
                                <span class="text-zinc-600"
                                    >password for the admin user on the web UI</span
                                >
                            </div>
                        </div>
                        <p class="text-zinc-500 text-xs mt-3">
                            The R2 vars from step 1 (<code class="text-zinc-400"
                                >R2_ACCESS_KEY_ID</code
                            >, <code class="text-zinc-400">R2_ACCOUNT_ID</code>, <code
                                class="text-zinc-400">R2_BUCKET_NAME</code
                            >) go into the worker environment variables.
                        </p>
                    </div>

                    <p class="text-zinc-500 text-xs mt-3">
                        After deploy, note your worker URL (e.g. <code
                            class="text-zinc-400"
                            >https://residue.your-subdomain.workers.dev</code
                        >).
                    </p>
                </div>
            </div>
        </div>

        <!-- Step 3: Install the CLI -->
        <div class="bg-zinc-900 border border-zinc-800 rounded-lg p-6">
            <div class="flex items-start gap-4">
                <div
                    class="w-8 h-8 rounded-full bg-amber-500/10 border border-amber-500/30 flex items-center justify-center shrink-0 mt-0.5"
                >
                    <Download class="w-4 h-4 text-amber-400" />
                </div>
                <div class="flex-1 min-w-0">
                    <div class="flex items-center gap-2 mb-1">
                        <span class="text-xs text-amber-400 font-semibold"
                            >Step 3</span
                        >
                    </div>
                    <h3 class="text-base font-semibold mb-3">
                        Install the CLI
                    </h3>

                    <div class="pkg-tabs" data-active="npm">
                        <div class="flex gap-0 mb-0 border-b border-zinc-800">
                            <button
                                class="pkg-tab px-3 py-1.5 text-xs font-semibold transition-colors"
                                data-pkg="npm">npm</button
                            >
                            <button
                                class="pkg-tab px-3 py-1.5 text-xs font-semibold transition-colors"
                                data-pkg="pnpm">pnpm</button
                            >
                            <button
                                class="pkg-tab px-3 py-1.5 text-xs font-semibold transition-colors"
                                data-pkg="yarn">yarn</button
                            >
                            <button
                                class="pkg-tab px-3 py-1.5 text-xs font-semibold transition-colors"
                                data-pkg="bun">bun</button
                            >
                        </div>
                        <pre
                            class="pkg-panel bg-zinc-950 rounded-b rounded-tr p-3 overflow-x-auto font-mono text-sm text-zinc-300"
                            data-pkg="npm"><code>npm install -g @residue/cli</code></pre>
                        <pre
                            class="pkg-panel bg-zinc-950 rounded-b rounded-tr p-3 overflow-x-auto font-mono text-sm text-zinc-300 hidden"
                            data-pkg="pnpm"><code>pnpm add -g @residue/cli</code></pre>
                        <pre
                            class="pkg-panel bg-zinc-950 rounded-b rounded-tr p-3 overflow-x-auto font-mono text-sm text-zinc-300 hidden"
                            data-pkg="yarn"><code>yarn global add @residue/cli</code></pre>
                        <pre
                            class="pkg-panel bg-zinc-950 rounded-b rounded-tr p-3 overflow-x-auto font-mono text-sm text-zinc-300 hidden"
                            data-pkg="bun"><code>bun add -g @residue/cli</code></pre>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 4: Login -->
        <div class="bg-zinc-900 border border-zinc-800 rounded-lg p-6">
            <div class="flex items-start gap-4">
                <div
                    class="w-8 h-8 rounded-full bg-amber-500/10 border border-amber-500/30 flex items-center justify-center shrink-0 mt-0.5"
                >
                    <LogIn class="w-4 h-4 text-amber-400" />
                </div>
                <div class="flex-1 min-w-0">
                    <div class="flex items-center gap-2 mb-1">
                        <span class="text-xs text-amber-400 font-semibold"
                            >Step 4</span
                        >
                    </div>
                    <h3 class="text-base font-semibold mb-3">Login</h3>

                    <pre
                        class="bg-zinc-950 rounded p-3 overflow-x-auto font-mono text-sm text-zinc-300 mb-3"><code>residue login --url https://residue.your-subdomain.workers.dev --token YOUR_AUTH_TOKEN</code></pre>

                    <div class="text-zinc-500 text-xs space-y-1">
                        <p>
                            <code class="text-zinc-400">--url</code> is your worker
                            URL from step 2.
                        </p>
                        <p>
                            <code class="text-zinc-400">--token</code> is the <code
                                class="text-zinc-400">AUTH_TOKEN</code
                            > you set in step 2.
                        </p>
                        <p>
                            This saves credentials to <code
                                class="text-zinc-400">~/.residue/config</code
                            >. You only need to do this once.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Per-project setup label -->
        <div class="flex items-center gap-3">
            <div class="h-px flex-1 bg-zinc-800"></div>
            <span class="text-xs text-zinc-500 uppercase tracking-wider"
                >Per-project setup</span
            >
            <div class="h-px flex-1 bg-zinc-800"></div>
        </div>

        <!-- Step 5: Set up a project -->
        <div class="bg-zinc-900 border border-zinc-800 rounded-lg p-6">
            <div class="flex items-start gap-4">
                <div
                    class="w-8 h-8 rounded-full bg-amber-500/10 border border-amber-500/30 flex items-center justify-center shrink-0 mt-0.5"
                >
                    <FolderGit2 class="w-4 h-4 text-amber-400" />
                </div>
                <div class="flex-1 min-w-0">
                    <div class="flex items-center gap-2 mb-1">
                        <span class="text-xs text-amber-400 font-semibold"
                            >Step 5</span
                        >
                    </div>
                    <h3 class="text-base font-semibold mb-3">
                        Initialize and connect your agent
                    </h3>

                    <p class="text-zinc-400 text-sm mb-3">
                        Run these in any git repository you want to track:
                    </p>

                    <pre
                        class="bg-zinc-950 rounded p-3 overflow-x-auto font-mono text-sm text-zinc-300 mb-3"><code><span class="text-zinc-500"># Install git hooks (post-commit + pre-push)</span>
residue init

<span class="text-zinc-500"># Set up your agent adapter</span>
residue setup claude-code   <span class="text-zinc-500"># or: residue setup pi</span></code></pre>

                    <p class="text-zinc-500 text-xs">
                        That's it. Commit and push as usual - conversations are
                        captured and uploaded automatically.
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .pkg-tab {
        color: var(--color-zinc-500);
        border-bottom: 2px solid transparent;
        margin-bottom: -1px;
    }
    .pkg-tab:hover {
        color: var(--color-zinc-300);
    }
    .pkg-tab.active {
        color: var(--color-amber-400);
        border-bottom-color: var(--color-amber-400);
    }
</style>

<script>
    document.querySelectorAll(".pkg-tabs").forEach((container) => {
        const tabs = container.querySelectorAll(".pkg-tab");
        const panels = container.querySelectorAll(".pkg-panel");

        function activate(pkg: string) {
            tabs.forEach((tab) => {
                if (tab.getAttribute("data-pkg") === pkg) {
                    tab.classList.add("active");
                } else {
                    tab.classList.remove("active");
                }
            });
            panels.forEach((panel) => {
                if (panel.getAttribute("data-pkg") === pkg) {
                    panel.classList.remove("hidden");
                } else {
                    panel.classList.add("hidden");
                }
            });
        }

        // Set initial active state
        activate(container.getAttribute("data-active") || "npm");

        tabs.forEach((tab) => {
            tab.addEventListener("click", () => {
                const pkg = tab.getAttribute("data-pkg");
                if (pkg) activate(pkg);
            });
        });
    });
</script>
