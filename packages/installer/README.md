# @residue/installer

Deployment installer for residue. Hosted at [install.residue.dev](https://install.residue.dev).

Automates the full setup: D1 database, R2 bucket, S3 API credentials, AI Search instance, secrets, and worker deployment. Also supports updating existing deployments at `/update`.

## How it works

The user provides a Cloudflare API token. The installer calls the Cloudflare API to provision all required resources, bundles the worker code (built at deploy time from `packages/worker`), and deploys it to the user's account.

The worker bundle, migrations, and static assets are pre-built and served from the installer's `public/` directory.

## Development

```bash
# Build and start dev server
pnpm run dev

# Deploy
pnpm run deploy
```

The `build` step has two phases:

1. `build:assets` -- Vite builds the client JS (install + update page scripts)
2. `build:worker` -- Dry-run deploys the worker package to capture the bundle, then copies the bundle, migrations, and static assets into `public/`

## Structure

```
src/
  index.tsx          Entry point (Hono app)
  types.ts           Shared types
  styles.css         Tailwind CSS entry
  client/            Client-side JS (Vite-built)
    install.ts       Install page interactivity
    update.ts        Update page interactivity
  lib/
    assets.ts        Worker asset upload helpers
    cloudflare.ts    Cloudflare API client
    deploy.ts        Worker deployment logic
    provision.ts     Resource provisioning (D1, R2, S3, AI Search)
    update.ts        Update flow logic
  routes/
    api.ts           API routes for install/update flows
  ui/
    layout.tsx       Shared HTML layout
    install.tsx      Install page (JSX)
    update.tsx       Update page (JSX)
public/              Built assets (generated by build step)
```
